{
  "info": {
    "name": "ProyectoFinal - Backend (collection)",
    "_postman_id": "proyectofinal-backend-collection",
    "description": "Colección generada automáticamente que incluye todos los endpoints del backend en back.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:8080", "type": "string" },
    { "key": "jwt", "value": "", "type": "string" },
    { "key": "webhookPath", "value": "/webhooks/whatsapp", "type": "string" }
  ],
  "item": [
    {
      "name": "AppUser",
      "item": [
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@ejemplo.com\",\n  \"password\": \"password123\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": { "raw": "{{baseUrl}}/app-user/login", "host": ["{{baseUrl}}"], "path": ["app-user","login"] }
          },
          "response": []
        },
        {
          "name": "Create user",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"email\": \"user@ejemplo.com\",\n  \"password\": \"password123\"\n}", "options": { "raw": { "language": "json" } } },
            "url": { "raw": "{{baseUrl}}/app-user", "host": ["{{baseUrl}}"], "path": ["app-user"] }
          }
        },
        {
          "name": "Get all users",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{jwt}}", "disabled": true } ],
            "url": { "raw": "{{baseUrl}}/app-user", "host": ["{{baseUrl}}"], "path": ["app-user"] }
          }
        },
        {
          "name": "Get user by email",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{jwt}}", "disabled": true } ],
            "url": { "raw": "{{baseUrl}}/app-user/:email", "host": ["{{baseUrl}}"], "path": ["app-user", ":email"] }
          }
        },
        {
          "name": "Update user (email)",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{jwt}}", "disabled": true } ],
            "body": { "mode": "raw", "raw": "{\n  \"email\": \"nuevo@ejemplo.com\",\n  \"password\": \"ignoredOrCurrent\"\n}", "options": { "raw": { "language": "json" } } },
            "url": { "raw": "{{baseUrl}}/app-user/:externalId", "host": ["{{baseUrl}}"], "path": ["app-user", ":externalId"] }
          }
        },
        {
          "name": "Delete user (soft)",
          "request": {
            "method": "DELETE",
            "header": [ { "key": "Authorization", "value": "Bearer {{jwt}}", "disabled": true } ],
            "url": { "raw": "{{baseUrl}}/app-user/:externalId", "host": ["{{baseUrl}}"], "path": ["app-user", ":externalId"] }
          }
        }
      ]
    },
    {
      "name": "ChatUser",
      "item": [
        {
          "name": "Get all chat users",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{baseUrl}}/chat-user", "host": ["{{baseUrl}}"], "path": ["chat-user"] } }
        },
        {
          "name": "Create chat user",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"email\": \"chatuser@ejemplo.com\",\n  \"phoneNumber\": \"+56911111111\"\n}", "options": { "raw": { "language": "json" } } },
            "url": { "raw": "{{baseUrl}}/chat-user", "host": ["{{baseUrl}}"], "path": ["chat-user"] }
          }
        },
        {
          "name": "Block chat user",
          "request": { "method": "PUT", "header": [], "url": { "raw": "{{baseUrl}}/chat-user/block/:externalId", "host": ["{{baseUrl}}"], "path": ["chat-user","block",":externalId"] } }
        },
        {
          "name": "Unblock chat user",
          "request": { "method": "PUT", "header": [], "url": { "raw": "{{baseUrl}}/chat-user/unblock/:externalId", "host": ["{{baseUrl}}"], "path": ["chat-user","unblock",":externalId"] } }
        },
        {
          "name": "Delete chat user",
          "request": { "method": "DELETE", "header": [], "url": { "raw": "{{baseUrl}}/chat-user/:externalId", "host": ["{{baseUrl}}"], "path": ["chat-user",":externalId"] } }
        }
      ]
    },
    {
      "name": "Documents",
      "item": [
        {
          "name": "Upload file (single)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                { "key": "file", "type": "file", "src": "" }
              ]
            },
            "url": { "raw": "{{baseUrl}}/documents/upload", "host": ["{{baseUrl}}"], "path": ["documents","upload"] }
          }
        },
        {
          "name": "Get all documents",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{baseUrl}}/documents", "host": ["{{baseUrl}}"], "path": ["documents"] } }
        }
      ]
    },
    {
      "name": "RAG",
      "item": [
        {
          "name": "Ingest files (multipart array)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                { "key": "files", "type": "file", "src": "" }
              ]
            },
            "url": { "raw": "{{baseUrl}}/rag/ingest", "host": ["{{baseUrl}}"], "path": ["rag","ingest"] }
          }
        },
        {
          "name": "Chat (test)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"question\": \"¿Cuál es la política de devoluciones?\"\n}", "options": { "raw": { "language": "json" } } },
            "url": { "raw": "{{baseUrl}}/rag/chat", "host": ["{{baseUrl}}"], "path": ["rag","chat"] }
          }
        }
      ]
    },
    {
      "name": "SystemPrompt",
      "item": [
        {
          "name": "Get latest",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{baseUrl}}/system-prompt", "host": ["{{baseUrl}}"], "path": ["system-prompt"] } }
        },
        {
          "name": "Patch system prompt",
          "request": {
            "method": "PATCH",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"prompt\": \"Nuevo prompt del sistema...\",\n  \"ticketEmail\": \"soporte@ejemplo.com\"\n}", "options": { "raw": { "language": "json" } } },
            "url": { "raw": "{{baseUrl}}/system-prompt", "host": ["{{baseUrl}}"], "path": ["system-prompt"] }
          }
        }
      ]
    },
    {
      "name": "Whatsapp Webhook",
      "item": [
        {
          "name": "Verify (GET)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}{{webhookPath}}?hub.mode=subscribe&hub.verify_token={{whatsappVerifyToken}}&hub.challenge=CHALLENGE", "host": ["{{baseUrl}}"], "path": ["{{webhookPath}}"] }
          },
          "description": "Verificación del webhook con parámetros: hub.mode, hub.verify_token, hub.challenge. NOTE: collection también define variable `webhookPath`."
        },
        {
          "name": "Receive (POST) - webhook payload",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "X-Hub-Signature-256", "value": "sha256=...", "disabled": true } ],
            "body": { "mode": "raw", "raw": "{\n  \"object\": \"whatsapp_business_account\",\n  \"entry\": [\n    {\n      \"changes\": [\n        {\n          \"value\": {\n            \"messages\": [\n              { \"from\": \"56911111111\", \"type\": \"text\", \"text\": { \"body\": \"Hola\" } }\n            ]\n          }\n        }\n      ]\n    }\n  ]\n}", "options": { "raw": { "language": "json" } } },
            "url": { "raw": "{{baseUrl}}{{webhookPath}}", "host": ["{{baseUrl}}"], "path": ["{{webhookPath}}"] }
          }
        }
      ]
    }
  ]
}

